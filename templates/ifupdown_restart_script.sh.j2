#!/bin/sh

returncode=0
{% for int in network_interface__all_changed_interfaces %}
if ! ifdown -v {{ int }}; then
    echo "Failed to bring down: {{ int }}"
    returncode=1
fi
{% endfor %}

sleep 1

{% for int in network_interface__all_changed_interfaces %}
if ! ifup -v {{ int }}; then
    echo "Failed to bring up: {{ int }}"
    returncode=1
fi
{% endfor %}

exit $returncode

# Shutdown current network configuration
# Ethernet
{% for int in ether_interfaces_changed %}
ifdown -v {{ int }}
{% endfor %}
# Bonding
{% for int in bond_interfaces_changed %}
ifdown -v {{ int }}
{% endfor %}
# {% if bond_result is defined and 'results' in bond_result %}{% for item in bond_result.results %}
# ifdown {{ item.item.device }}
# {% endfor %}{% endif %}
# Vlan 
{% for int in vlan_interfaces_changed %}
ifdown -v {{ int }}
{% endfor %}

# Short delay to prevent issues
sleep 1

# Start new network configuration
# Ethernet
{% for int in ether_interfaces_changed %}
ifup -v {{ int }}
{% endfor %}
# Bonding
{% for int in bond_interfaces_changed %}
ifup -v {{ int }}
{% endfor %}
# {% if bond_result is defined and 'results' in bond_result %}{% for item in bond_result.results %}
# ifup {{ item.item.device }}
# {% endfor %}{% endif %}
# Vlan 
{% for int in vlan_interfaces_changed %}
ifup -v {{ int }}
{% endfor %}


