- hosts: all
  become: yes
  vars:
    test_iface_name: lo
    network_loopback_interfaces:
      - device: "{{ test_iface_name }}"

  become: yes

  tasks:

    - name: "Running test [007]"
      debug: msg="[007]"

    - include_tasks: helpers/set_test_variables.yaml

    # import_role instead of include_role
    # to make role's variables available in this test
    - import_role:
        name: network_interface

    - name: debug pause after role has run
      include_tasks: helpers/debug_pause.yaml

    # - name: Compare templated file
    #   include_tasks: helpers/compare_lines.yaml
    #   vars:
    #     compare_lines_from_file: "{{ net_path }}/{{ network_interface_file_prefix }}{{ test_iface_name }}"
    #     compare_lines_to: |
    #       auto {{ test_iface_name }}
    #       iface {{ test_iface_name }} inet loopback
    #   when: ansible_os_family == "Debian"

    - include_tasks: helpers/test_file_contents.yaml
      vars:
        file: "{{ net_path }}/{{ network_interface_file_prefix }}{{ test_iface_name }}"
        regexp: '\s*auto {{ test_iface_name }}\s*\n\s*iface {{test_iface_name }} inet loopback\s*$'
        
    - include_tasks: helpers/flush_handlers.yaml
      

    - include_tasks: tasks/system_interface_control.yaml
      vars:
        interface: "{{ test_iface_name }}"
        state: restart
      when: not network_restart_interfaces
        
    - name: Stop interface
      include_tasks: tasks/system_interface_control.yaml
      vars:
        interface: "{{ test_iface_name }}"
        state: down
        
