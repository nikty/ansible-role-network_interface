- hosts: all
  vars:
    network_configured_interfaces_only: yes
    network_restart_interfaces: false
    network_interface_implicit_loopback: yes

  become: yes
  tasks:

    - include_tasks: helpers/backup_and_restore_original_network_config.yaml
      vars:
        action: backup

    - name: Add test interface
      include_tasks: helpers/manage_test_interface.yaml
      vars:
        interface: veth0
        type: veth
        state: present

    - name: Add test interface
      include_tasks: helpers/manage_test_interface.yaml
      vars:
        interface: veth1
        type: veth
        state: present

    - import_role:
        name: network_interface
      vars:
        network_bond_interfaces:
          - device: bond0
            mtu: 1000
            debian_command_options:
              - up true
              - down true
            interfaces: [ veth0, veth1 ]
            parameters:
              mode: 802.3ad


    - pause:
      when: lookup('env', 'TEST_PAUSE')
      


    - name: Add test interface
      include_tasks: helpers/manage_test_interface.yaml
      vars:
        interface: veth0
        type: veth
        state: ansent

    - name: Add test interface
      include_tasks: helpers/manage_test_interface.yaml
      vars:
        interface: veth1
        type: veth
        state: absent

    - include_tasks: helpers/backup_and_restore_original_network_config.yaml
      vars:
        action: restore
