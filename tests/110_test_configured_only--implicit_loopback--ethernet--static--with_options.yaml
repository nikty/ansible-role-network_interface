- hosts: all
  vars:
    network_interface_configured_only: yes
    network_restart_interfaces: false
    network_interface_implicit_loopback: yes

    test_iface_name: veth0
    test_ip_address: 192.0.2.2/24
    test_options:
      - up /bin/true
      - up /bin/false || true
      
  become: yes
  tasks:

    - include_tasks: helpers/backup_and_restore_original_network_config.yaml
      vars:
        action: backup

    - name: Add test interface
      include_tasks: helpers/manage_test_interface.yaml
      vars:
        interface: "{{ test_iface_name }}"
        type: veth
        state: present

    - name: Configure loopback only
      import_role:
        name: network_interface
      vars:
        network_ether_interfaces:
          - device: "{{ test_iface_name }}"
            addresses:
              - "{{ test_ip_address }}"
            debian_command_options: "{{ test_options }}"


    - pause:
      when: lookup('env', 'TEST_PAUSE')
      
    - include_tasks: helpers/backup_and_restore_original_network_config.yaml
      vars:
        action: restore
